service cloud.firestore {
  match /databases/{database}/documents {
    // match /{document=**} {
      // allow read, write;
    // }
    // Function in rules
    function signedInOrPublic() {
      return request.auth.uid != null || resource.data.visibility == 'public';
    }

    match /users/{userId} {
      // allow read: if requesta.auth.uid == $userId;
      // allow write: if requesta.auth.uid == $userId;
      allow read, write: if true;
    }
    match /categories/{id} {
      allow read: if true;
      allow write: if false;
    }
    match /products/{productId} {
      allow read: if true;
      allow write: if true;
    }
    // https://firebase.google.com/docs/firestore/security/rules-query
    match /stories/{storyId} {
      allow list: if request.query.limit <= 10 && resource.data.status != 1;
      allow read: if resource.data.status == 1;
      allow write: if request.auth.uid != null;
    }

    match /registrations/{regId} {
      allow read: if false;
      allow write: if true;
    }

    match /activations/{email} {
      allow read: if false;
      allow write: if request.resource.data.code == resource.data.code && resource.data.status == 1;
    }

  }
}
